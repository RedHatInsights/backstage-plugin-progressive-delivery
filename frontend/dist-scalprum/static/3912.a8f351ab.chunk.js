(self.webpackChunkplugin_progressive_delivery=self.webpackChunkplugin_progressive_delivery||[]).push([[3912],{58511:(e,t,o)=>{"use strict";o.r(t),o.d(t,{TopologyComponent:()=>d});var s=o(74848),r=o(28437),n=o.n(r),a=o(39839),i=o(78092),c=o(21717),l=o(22097);const d=()=>{const[e,t]=(0,r.useState)("{}"),o=(0,l.useApi)(l.configApiRef).getString("backend.baseUrl");(0,r.useEffect)((()=>{fetch(o+"/api/plugin-progressive-delivery-backend/topo").then((e=>e.text())).then((e=>t(e)))}),[]);const n=(0,i.u)().entity.metadata.name.toLowerCase();if("{}"!==e){try{var c=JSON.parse(e)}catch{return(0,s.jsx)(a.nO,{title:"Progressive Delivery Topology",children:"Error parsing json"})}console.log("Data: ",c);let t=c.edges.filter((([e,t])=>{const o=JSON.parse(e),s=JSON.parse(t);return o.app.toLowerCase()===n.toLowerCase()||s.app.toLowerCase()===n.toLowerCase()}));t=function(e){let t={};for(const[o,s]of e)s in t||(t[s]=new Set),t[s].add(o);let o={};for(const[e,s]of Object.entries(t)){const t=JSON.stringify(Array.from(s));t in o||(o[t]=new Set),o[t].add(e)}let s={};for(const[e,o]of Object.entries(t))if(o.size>1){const e=JSON.stringify(Array.from(o));e in s||(s[e]=0),s[e]+=1}let r=0;for(const[t,n]of Object.entries(s))if(n>1){const s="soak-"+r++,n=JSON.parse(t),a=o[t];for(const t of n)for(const o of Array.from(a))(e=e.filter((e=>!(e[0]===t&&e[1]===o)))).some((e=>e[0]===t&&e[1]===s))||e.push([t,s]),e.some((e=>e[0]===s&&e[1]===o))||e.push([s,o])}return e}(t),console.log("Edges: ",t);const o=new Set;t.forEach((([e,t])=>{o.add(e),o.add(t)})),c.nodes.map((e=>JSON.parse(e))).filter((e=>e.app.toLowerCase()==n.toLowerCase())).forEach((e=>o.add(JSON.stringify(e)))),console.log("Nodes: ",o);const r=Array.from(o).map((e=>({id:e}))),i=t.map((([e,t])=>({from:e,to:t})));return(0,s.jsx)(a.nO,{title:"Progressive Delivery Topology",children:(0,s.jsx)(a.wB,{nodes:r,edges:i,showArrowHeads:!0,renderNode:p,direction:a.DT.Direction.LEFT_RIGHT})})}return(0,s.jsx)(a.nO,{title:"Progressive Delivery Topology",children:"Processing ..."})};function p({node:{id:e}}){const[t,o]=n().useState(0),[r,a]=n().useState(0),i=n().useRef(null);n().useLayoutEffect((()=>{if(i.current){let{height:e,width:s}=i.current.getBBox();e=Math.round(e),s=Math.round(s),e===r&&s===t||(o(s),a(e))}}),[t,r]);const c=t+20,l=r+20;let d=JSON.parse(e),p="none";var g;d.commit_sha&&(p=d.commit_sha.length>=32?null===(g=d.commit_sha)||void 0===g?void 0:g.substring(0,7):d.commit_sha);let u="success"==d.deployment_state?"✅":"❌",h=[`${d.resourceTemplate}/${d.target}`,`on ${d.cluster}/${d.namespace} (${d.saas})`,`${p} ${u}`].map(((e,t)=>(0,s.jsx)("tspan",{x:c/2,y:2*(t+1)*10,fontWeight:t<1?"bold":"normal",children:e})));const m=f({isTest:d.isTest});return(0,s.jsxs)("g",{children:[(0,s.jsx)("rect",{className:m.node,width:c,height:l,rx:10}),(0,s.jsx)("text",{ref:i,className:m.text,y:l/2,x:2*c,textAnchor:"middle",alignmentBaseline:"middle",children:h}),")"]})}const f=(0,c.makeStyles)((e=>({node:{fill:e=>g(e)?"#FFF3D1":"#DCE8FA",stroke:e=>g(e)?"#FFE59E":"#9BB3D6"},edge:{strokeWidth:2},path:{strokeWidth:2},text:{fill:()=>"light"===e.palette.type?"black":e.palette.primary.contrastText}})),{name:"BackstageDependencyGraphDefaultNode"});function g(e){return!!e.isTest}},42634:()=>{}}]);
//# sourceMappingURL=3912.a8f351ab.chunk.js.map