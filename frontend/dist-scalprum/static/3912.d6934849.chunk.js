(self.webpackChunkplugin_progressive_delivery=self.webpackChunkplugin_progressive_delivery||[]).push([[3912],{58511:(e,t,s)=>{"use strict";s.r(t),s.d(t,{TopologyComponent:()=>c});var o=s(74848),r=s(28437),n=s.n(r),i=s(12768),a=s(81067),l=s(21717);const c=()=>{const[e,t]=(0,r.useState)("{}");(0,r.useEffect)((()=>{fetch("http://localhost:7007/api/progressive-delivery/topo").then((e=>(console.log(e),e.text()))).then((e=>(console.log(e),t(e))))}),[]);const s=(0,a.u)().entity.metadata.name.toLowerCase();if("{}"!==e){try{var n=JSON.parse(e)}catch{return(0,o.jsx)(i.nO,{title:"Progressive Delivery Topology",children:"Error parsing json"})}const t=n.edges.map((([e,t])=>({from:JSON.parse(e),to:JSON.parse(t)}))).filter((({from:e,to:t})=>e.app.toLowerCase()===s.toLowerCase()||t.app.toLowerCase()===s.toLowerCase())).map((({from:e,to:t})=>({from:JSON.stringify(e),to:JSON.stringify(t)})));let r=n.nodes.map((e=>JSON.parse(e))).filter((e=>e.app.toLowerCase()==s.toLowerCase())).map((e=>({id:JSON.stringify(e)})));return t.forEach((e=>{r.push({id:e.from}),r.push({id:e.to})})),(0,o.jsx)(i.nO,{title:"Progressive Delivery Topology",children:(0,o.jsx)(i.wB,{nodes:r,edges:t,showArrowHeads:!0,renderNode:p,direction:i.DT.Direction.LEFT_RIGHT})})}return(0,o.jsx)(i.nO,{title:"Progressive Delivery Topology",children:"Processing ..."})};function p({node:{id:e}}){const[t,s]=n().useState(0),[r,i]=n().useState(0),a=n().useRef(null);n().useLayoutEffect((()=>{if(a.current){let{height:e,width:o}=a.current.getBBox();e=Math.round(e),o=Math.round(o),e===r&&o===t||(s(o),i(e))}}),[t,r]);const l=t+20,c=r+20;let p=JSON.parse(e),h="none";var u;p.commit_sha&&(h=p.commit_sha.length>=32?null===(u=p.commit_sha)||void 0===u?void 0:u.substring(0,7):p.commit_sha);let g="success"==p.deployment_state?"✅":"❌",m=[`${p.resourceTemplate}/${p.target}`,`on ${p.cluster}/${p.namespace} (${p.saas})`,`${h} ${g}`].map(((e,t)=>(0,o.jsx)("tspan",{x:l/2,y:2*(t+1)*10,fontWeight:t<1?"bold":"normal",children:e})));const f=d({isTest:p.isTest});return(0,o.jsxs)("g",{children:[(0,o.jsx)("rect",{className:f.node,width:l,height:c,rx:10}),(0,o.jsx)("text",{ref:a,className:f.text,y:c/2,x:2*l,textAnchor:"middle",alignmentBaseline:"middle",children:m}),")"]})}const d=(0,l.makeStyles)((e=>({node:{fill:e=>h(e)?"#FFF3D1":"#DCE8FA",stroke:e=>h(e)?"#FFE59E":"#9BB3D6"},edge:{strokeWidth:2},path:{strokeWidth:2},text:{fill:()=>"light"===e.palette.type?"black":e.palette.primary.contrastText}})),{name:"BackstageDependencyGraphDefaultNode"});function h(e){return!!e.isTest}},42634:()=>{}}]);
//# sourceMappingURL=3912.d6934849.chunk.js.map