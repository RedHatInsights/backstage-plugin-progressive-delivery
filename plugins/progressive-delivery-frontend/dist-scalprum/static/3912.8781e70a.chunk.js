(self.webpackChunkplugin_progressive_delivery=self.webpackChunkplugin_progressive_delivery||[]).push([[3912],{58511:(e,t,s)=>{"use strict";s.r(t),s.d(t,{TopologyComponent:()=>p});var r=s(74848),o=s(28437),n=s.n(o),i=s(39839),a=s(78092),c=s(21717),l=s(22097);const d="soak",p=()=>{const[e,t]=(0,o.useState)("{}"),s=(0,l.useApi)(l.configApiRef).getString("backend.baseUrl");(0,o.useEffect)((()=>{fetch(s+"/api/plugin-progressive-delivery-backend/topo").then((e=>e.text())).then((e=>t(e)))}),[]);const n=(0,a.u)().entity;let c=n.metadata.name.toLowerCase();if(n.spec&&n.spec.system&&(c=n.spec.system.toString()),"{}"!==e){try{var p=JSON.parse(e)}catch{return(0,r.jsx)(i.nO,{title:"Progressive Delivery Topology",children:"Error parsing json"})}let t=p.edges.filter((([e,t])=>{const s=JSON.parse(e),r=JSON.parse(t);return s.app.toLowerCase()===c.toLowerCase()||r.app.toLowerCase()===c.toLowerCase()}));t=function(e){let t={};for(const[s,r]of e)r in t||(t[r]=new Set),t[r].add(s);let s={};for(const[e,r]of Object.entries(t)){const t=JSON.stringify(Array.from(r));t in s||(s[t]=new Set),s[t].add(e)}let r={};for(const[e,s]of Object.entries(t))if(s.size>1){const e=JSON.stringify(Array.from(s));e in r||(r[e]=0),r[e]+=1}let o=0;for(const[t,n]of Object.entries(r))if(n>1){const r=`${d}-${o++}`,n=JSON.parse(t),i=s[t];for(const t of n)for(const s of Array.from(i))(e=e.filter((e=>!(e[0]===t&&e[1]===s)))).some((e=>e[0]===t&&e[1]===r))||e.push([t,r]),e.some((e=>e[0]===r&&e[1]===s))||e.push([r,s])}return e}(t);const s=new Set;t.forEach((([e,t])=>{s.add(e),s.add(t)}));const o=Array.from(s).map((e=>({id:e}))),n=t.map((([e,t])=>({from:e,to:t})));return(0,r.jsx)(i.nO,{title:"Progressive Delivery Topology",children:(0,r.jsx)(i.wB,{nodes:o,edges:n,showArrowHeads:!0,renderNode:f,direction:i.DT.Direction.LEFT_RIGHT})})}return(0,r.jsx)(i.nO,{title:"Progressive Delivery Topology",children:"Processing ..."})};function f({node:{id:e}}){const[t,s]=n().useState(0),[o,i]=n().useState(0),a=n().useRef(null);n().useLayoutEffect((()=>{if(a.current){let{height:e,width:r}=a.current.getBBox();e=Math.round(e),r=Math.round(r),e===o&&r===t||(s(r),i(e))}}),[t,o]);const c=t+20,l=o+20;if(e.match(new RegExp(`^${d}-\\d+$`))){const e=h({isTest:!1});return(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{className:e.node,width:c,height:l,rx:10}),(0,r.jsx)("text",{ref:a,className:e.text,y:l/2,x:c/2,textAnchor:"middle",alignmentBaseline:"middle",children:d})]})}const p=JSON.parse(e);let f="none";var m;p.commit_sha&&(f=p.commit_sha.length>=32?null===(m=p.commit_sha)||void 0===m?void 0:m.substring(0,7):p.commit_sha);let u="success"==p.deployment_state?"✅":"❌",g=[`${p.resourceTemplate}/${p.target}`,`on ${p.cluster}/${p.namespace} (${p.saas})`,`${f} ${u}`].map(((e,t)=>(0,r.jsx)("tspan",{x:c/2,y:2*(t+1)*10,fontWeight:t<1?"bold":"normal",children:e})));const y=h({isTest:p.isTest});return(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{className:y.node,width:c,height:l,rx:10}),(0,r.jsx)("text",{ref:a,className:y.text,y:l/2,x:2*c,textAnchor:"middle",alignmentBaseline:"middle",children:g}),")"]})}const h=(0,c.makeStyles)((e=>({node:{fill:e=>m(e)?"#FFF3D1":"#DCE8FA",stroke:e=>m(e)?"#FFE59E":"#9BB3D6"},edge:{strokeWidth:2},path:{strokeWidth:2},text:{fill:()=>"light"===e.palette.type?"black":e.palette.primary.contrastText}})),{name:"BackstageDependencyGraphDefaultNode"});function m(e){return!!e.isTest}},42634:()=>{}}]);
//# sourceMappingURL=3912.8781e70a.chunk.js.map