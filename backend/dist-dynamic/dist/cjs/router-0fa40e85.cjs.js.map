{"version":3,"file":"router-0fa40e85.cjs.js","sources":["../../src/service/router.ts"],"sourcesContent":["import { errorHandler } from '@backstage/backend-common';\nimport express from 'express';\nimport Router from 'express-promise-router';\nimport { Logger } from 'winston';\nimport fs from 'fs';\n\nexport interface RouterOptions {\n  logger: Logger;\n}\n\nexport async function createRouter(\n  options: RouterOptions,\n): Promise<express.Router> {\n  const { logger } = options;\n\n  const router = Router();\n  router.use(express.json());\n\n  router.get('/health', (_, response) => {\n    logger.info('PONG!');\n    response.json({ status: 'ok' });\n  });\n  router.get('/topo', (_, response) => {\n    // TODO: Change to config.progressiveDelivery.topoPath\n    //\n    // var data = require('json!/data/data.json');\n    // response.write(data);\n    // fetch('file:///data/data.json').then(resp => {\n    //   if (!resp.ok) {\n    //     response.write(\"\")\n    //   } else {\n    //     response.write(resp.json())\n    //   }\n    // });\n    // }).then(data => response.write(data));\n    fs.readFile('/data/data/json', function read(err, data) {\n      if (err) {\n        response.write(\"\");\n        return;\n      }\n      console.log(data);\n      // TODO: JSON.parse?\n      response.write(data);\n    })\n  })\n  router.use(errorHandler());\n  return router;\n}\n\n"],"names":["Router","express","fs","errorHandler"],"mappings":";;;;;;;;;;;;;AAUA,eAAsB,aACpB,OACyB,EAAA;AACzB,EAAM,MAAA,EAAE,QAAW,GAAA,OAAA,CAAA;AAEnB,EAAA,MAAM,SAASA,0BAAO,EAAA,CAAA;AACtB,EAAO,MAAA,CAAA,GAAA,CAAIC,2BAAQ,CAAA,IAAA,EAAM,CAAA,CAAA;AAEzB,EAAA,MAAA,CAAO,GAAI,CAAA,SAAA,EAAW,CAAC,CAAA,EAAG,QAAa,KAAA;AACrC,IAAA,MAAA,CAAO,KAAK,OAAO,CAAA,CAAA;AACnB,IAAA,QAAA,CAAS,IAAK,CAAA,EAAE,MAAQ,EAAA,IAAA,EAAM,CAAA,CAAA;AAAA,GAC/B,CAAA,CAAA;AACD,EAAA,MAAA,CAAO,GAAI,CAAA,OAAA,EAAS,CAAC,CAAA,EAAG,QAAa,KAAA;AAanC,IAAAC,sBAAA,CAAG,QAAS,CAAA,iBAAA,EAAmB,SAAS,IAAA,CAAK,KAAK,IAAM,EAAA;AACtD,MAAA,IAAI,GAAK,EAAA;AACP,QAAA,QAAA,CAAS,MAAM,EAAE,CAAA,CAAA;AACjB,QAAA,OAAA;AAAA,OACF;AACA,MAAA,OAAA,CAAQ,IAAI,IAAI,CAAA,CAAA;AAEhB,MAAA,QAAA,CAAS,MAAM,IAAI,CAAA,CAAA;AAAA,KACpB,CAAA,CAAA;AAAA,GACF,CAAA,CAAA;AACD,EAAO,MAAA,CAAA,GAAA,CAAIC,4BAAc,CAAA,CAAA;AACzB,EAAO,OAAA,MAAA,CAAA;AACT;;;;"}